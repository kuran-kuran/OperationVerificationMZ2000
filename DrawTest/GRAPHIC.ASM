; GRAMアドレス有効
ENABLE_GRAPHIC_ADDR:
	IN	A, (0E8h)
	AND	03Fh
	OR	080h
	OUT	(0E8h), A
	RET

; GRAMアドレス無効
DISABLE_GRAPHIC_ADDR:
	IN	A, (0E8h)
	AND	07Fh
	OUT	(0E8h), A
	RET

; グラフィックス画面を3ページとも消去する
GRAPHICS_CLS_ALL:
	LD	A, 1
	OUT	(0F7h), A
	CALL	GRAPHICS_CLS
	LD	A, 2
	OUT	(0F7h), A
	CALL	GRAPHICS_CLS
	LD	A, 3
	OUT	(0F7h), A
	CALL	GRAPHICS_CLS
	RET

; グラフィックス画面を1ページ分消去する
GRAPHICS_CLS:
	LD	HL, 0C000h
	LD	BC, 16000
GRAPHICS_CLS_L1:
	LD	(HL), 0
	INC	HL
	DEC	BC
	LD	A, B
	OR	C
	JR	NZ, GRAPHICS_CLS_L1
	RET

;16x2(4) 8色を転送する
;	LD	DE, POSITION
;	LD	HL, PATTERN
PUT16x2x8:
	PUSH	DE
	LD	(PUT16x2x8_RESTORE_STACK + 1), SP
	; B
	LD	A, 1
	OUT	(0F7h), A
	LD	SP, HL
	EX	DE, HL
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
	INC	HL
	LD	BC, 158
	ADD	HL, BC
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
	; R
	LD	A, 2
	OUT	(0F7h), A
	LD	BC, 161
	OR	A
	SBC	HL, BC
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
	INC	HL
	LD	BC, 158
	ADD	HL, BC
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
	; G
	LD	A, 3
	OUT	(0F7h), A
	LD	BC, 161
	OR	A
	SBC	HL, BC
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
	INC	HL
	LD	BC, 158
	ADD	HL, BC
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
PUT16x2x8_RESTORE_STACK:
	LD	SP, 0000
	POP	DE
	RET

;16x2(4)単色を転送する
;	LD	DE, POSITION
;	LD	HL, PATTERN
PUT16x2:
	PUSH	DE
	LD	(PUT16x2_RESTORE_STACK + 1), SP
	LD	SP, HL
	EX	DE, HL
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
	INC	HL
	LD	BC, 158
	ADD	HL, BC
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
PUT16x2_RESTORE_STACK:
	LD	SP, 0000
	POP	DE
	RET

;16x4単色を転送する
;	LD	DE, POSITION
;	LD	HL, PATTERN
PUT16x4:
	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	(PUT16x4_RESTORE_STACK + 1), SP
	LD	SP, HL
	EX	DE, HL
	LD	BC, 78
	REPT 3
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
	INC	HL
	ADD	HL, BC
	ENDM
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
PUT16x4_RESTORE_STACK:
	LD	SP, 0000
	POP	HL
	POP	DE
	POP	BC
	RET

;8x4単色をAND転送する
;	LD	DE, POSITION
;	LD	HL, PATTERN
PUT_AND_8x4:
	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	(PUT_AND_8x4_RESTORE_STACK + 1), SP
	LD	SP, HL
	EX	DE, HL
	LD	BC, 80
	POP	DE
	LD	A, E
	AND	(HL)
	LD	(HL), A
	ADD	HL, BC
	LD	A, D
	AND	(HL)
	LD	(HL), A
	ADD	HL, BC
	POP	DE
	LD	A, E
	AND	(HL)
	LD	(HL), A
	ADD	HL, BC
	LD	A, D
	AND	(HL)
	LD	(HL), A
PUT_AND_8x4_RESTORE_STACK:
	LD	SP, 0000
	POP	HL
	POP	DE
	POP	BC
	RET

;8x4単色を32x4の左端右端にAND転送する
;	LD	DE, POSITION
;	LD	HL, PATTERN
PUT_AND_ZAPPER:
	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	(PUT_AND_ZAPPER_RESTORE_STACK + 1), SP
	LD	SP, HL
	EX	DE, HL
	LD	BC, 77
	REPT 3
	POP	DE
	LD	A, E
	AND	(HL)
	LD	(HL), A
	INC	HL
	INC	HL
	INC	HL
	LD	A, D
	AND	(HL)
	LD	(HL), A
	ADD	HL, BC
	ENDM
	POP	DE
	LD	A, E
	AND	(HL)
	LD	(HL), A
	INC	HL
	INC	HL
	INC	HL
	LD	A, D
	AND	(HL)
	LD	(HL), A
PUT_AND_ZAPPER_RESTORE_STACK:
	LD	SP, 0000
	POP	HL
	POP	DE
	POP	BC
	RET

;16x4単色をクリアする
;	LD	HL, POSITION
CLEAR16x4:
	XOR	A
	LD	BC, 79
	REPT 3
	LD	(HL), A
	INC	HL
	LD	(HL), A
	ADD	HL, BC
	ENDM
	LD	(HL), A
	INC	HL
	LD	(HL), A
	RET

;16x4 青と赤プレーンをクリアする
;	LD	DE, POSITION
CLEAR16x4_BR:
	PUSH	HL
	PUSH	BC
	LD	H, D
	LD	L, E
	LD	A, 1
	OUT	(0F7h), A
	CALL	CLEAR16x4
	LD	H, D
	LD	L, E
	LD	A, 2
	OUT	(0F7h), A
	CALL	CLEAR16x4
	POP	BC
	POP	HL
	RET

;16x8単色を転送する
;	LD	DE, POSITION
;	LD	HL, PATTERN
PUT16x8:
	LD	(PUT16x8_RESTORE_STACK + 1), SP
	LD	SP, HL
	EX	DE, HL
	LD	BC, 79
	REPT 7
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
	ADD	HL, BC
	ENDM
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
PUT16x8_RESTORE_STACK:
	LD	SP, 0000
	RET

;32x4単色を転送する
;	LD	DE, POSITION
;	LD	HL, PATTERN
PUT32x4:
	LD	(PUT32x4_RESTORE_STACK + 1), SP
	LD	SP, HL
	EX	DE, HL
	LD	BC, 77
	REPT 3
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
	INC	HL
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
	ADD	HL, BC
	ENDM
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
	INC	HL
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
PUT32x4_RESTORE_STACK:
	LD	SP, 0000
	RET

;32x4単色をAND転送する
;	LD	HL, POSITION
;	LD	DE, PATTERN
PUT_AND_32x4:
	LD	(PUT_AND_32x4_RESTORE_STACK + 1), SP
	LD	SP, HL
	EX	DE, HL
	LD	BC, 77
	REPT 3
	POP	DE
	LD	A, E
	AND	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	AND	(HL)
	LD	(HL), A
	INC	HL
	POP	DE
	LD	A, E
	AND	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	AND	(HL)
	LD	(HL), A
	ADD	HL, BC
	ENDM
	POP	DE
	LD	A, E
	AND	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	AND	(HL)
	LD	(HL), A
	INC	HL
	POP	DE
	LD	A, E
	AND	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	AND	(HL)
	LD	(HL), A
PUT_AND_32x4_RESTORE_STACK:
	LD	SP, 0000
	RET

;32x4単色をOR転送する
;	LD	HL, POSITION
;	LD	DE, PATTERN
PUT_OR_32x4:
	LD	(PUT_OR_32x4_RESTORE_STACK + 1), SP
	LD	SP, HL
	EX	DE, HL
	LD	BC, 77
	REPT 3
	POP	DE
	LD	A, E
	OR	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	OR	(HL)
	LD	(HL), A
	INC	HL
	POP	DE
	LD	A, E
	OR	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	OR	(HL)
	LD	(HL), A
	ADD	HL, BC
	ENDM
	POP	DE
	LD	A, E
	OR	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	OR	(HL)
	LD	(HL), A
	INC	HL
	POP	DE
	LD	A, E
	OR	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	OR	(HL)
	LD	(HL), A
PUT_OR_32x4_RESTORE_STACK:
	LD	SP, 0000
	RET

;32x16単色を転送する
;	LD	DE, POSITION
;	LD	HL, PATTERN
PUT32x16:
	LD	(PUT32x16_RESTORE_STACK + 1), SP
	LD	SP, HL
	EX	DE, HL
	LD	BC, 77
	REPT 15
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
	INC	HL
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
	ADD	HL, BC
	ENDM
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
	INC	HL
	POP	DE
	LD	(HL), E
	INC	HL
	LD	(HL), D
PUT32x16_RESTORE_STACK:
	LD	SP, 0000
	RET

;32x16単色をAND転送する
;	LD	DE, POSITION
;	LD	HL, PATTERN
PUT_AND_32x16:
	LD	(PUT_AND_32x16_RESTORE_STACK + 1), SP
	LD	SP, HL
	EX	DE, HL
	LD	BC, 77
	REPT 15
	POP	DE
	LD	A, E
	AND	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	AND	(HL)
	LD	(HL), A
	INC	HL
	POP	DE
	LD	A, E
	AND	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	AND	(HL)
	LD	(HL), A
	ADD	HL, BC
	ENDM
	POP	DE
	LD	A, E
	AND	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	AND	(HL)
	LD	(HL), A
	INC	HL
	POP	DE
	LD	A, E
	AND	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	AND	(HL)
	LD	(HL), A
	LD	(PUT_AND_32x16_LD_HL_SP + 1), SP
PUT_AND_32x16_LD_HL_SP:
	LD	HL, 0000
PUT_AND_32x16_RESTORE_STACK:
	LD	SP, 0000
	RET

;32x16単色をOR転送する
;	LD	DE, POSITION
;	LD	HL, PATTERN
PUT_OR_32x16:
	LD	(PUT_OR_32x16_RESTORE_STACK + 1), SP
	LD	SP, HL
	EX	DE, HL
	LD	BC, 77
	REPT 15
	POP	DE
	LD	A, E
	OR	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	OR	(HL)
	LD	(HL), A
	INC	HL
	POP	DE
	LD	A, E
	OR	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	OR	(HL)
	LD	(HL), A
	ADD	HL, BC
	ENDM
	POP	DE
	LD	A, E
	OR	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	OR	(HL)
	LD	(HL), A
	INC	HL
	POP	DE
	LD	A, E
	OR	(HL)
	LD	(HL), A
	INC	HL
	LD	A, D
	OR	(HL)
	LD	(HL), A
	LD	(PUT_OR_32x16_LD_HL_SP + 1), SP
PUT_OR_32x16_LD_HL_SP:
	LD	HL, 0000
PUT_OR_32x16_RESTORE_STACK:
	LD	SP, 0000
	RET
